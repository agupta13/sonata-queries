pktstream.window(self.window_length, self.sliding_interval).transform(lambda rdd: (rdd.filter(lambda p : (p[1]==str('10008'))).map(lambda p : (p[2:])).map(lambda ((tcp_dport,ipv4_totalLen,ipv4_srcIP,ipv4_protocol,ipv4_dstIP)): ((tcp_dport,ipv4_totalLen,ipv4_srcIP,ipv4_protocol,ipv4_dstIP))).map(lambda ((tcp_dport,ipv4_totalLen,ipv4_srcIP,ipv4_protocol,ipv4_dstIP)): ((ipv4_dstIP,ipv4_srcIP,ipv4_totalLen))).distinct().map(lambda ((ipv4_dstIP,ipv4_srcIP,ipv4_totalLen)): ((ipv4_dstIP,ipv4_totalLen))).map(lambda ((ipv4_dstIP,ipv4_totalLen)): ((ipv4_dstIP,ipv4_totalLen),(1))).reduceByKey(lambda x,y: x+y).filter(lambda ((ipv4_dstIP,ipv4_totalLen),(count)): ((float(count)>=40 ))).map(lambda ((ipv4_dstIP,ipv4_totalLen),(count)): ((ipv4_dstIP))))).foreachRDD(lambda rdd:send_reduction_keys(rdd, (u'localhost', 4949),0,'10008'))
pktstream.window(self.window_length, self.sliding_interval).transform(lambda rdd: (rdd.filter(lambda p : (p[1]==str('10032'))).map(lambda p : (p[2:])).map(lambda ((tcp_dport,ipv4_totalLen,ipv4_srcIP,ipv4_protocol,ipv4_dstIP)): ((tcp_dport,ipv4_totalLen,ipv4_srcIP,ipv4_protocol,ipv4_dstIP))).map(lambda ((tcp_dport,ipv4_totalLen,ipv4_srcIP,ipv4_protocol,ipv4_dstIP)): ((ipv4_dstIP,ipv4_srcIP,ipv4_totalLen))).distinct().map(lambda ((ipv4_dstIP,ipv4_srcIP,ipv4_totalLen)): ((ipv4_dstIP,ipv4_totalLen))).map(lambda ((ipv4_dstIP,ipv4_totalLen)): ((ipv4_dstIP,ipv4_totalLen),(1))).reduceByKey(lambda x,y: x+y).filter(lambda ((ipv4_dstIP,ipv4_totalLen),(count)): ((float(count)>=40 ))).map(lambda ((ipv4_dstIP,ipv4_totalLen),(count)): ((ipv4_dstIP))))).foreachRDD(lambda rdd:send_reduction_keys(rdd, (u'localhost', 4949),0,'10032'))
